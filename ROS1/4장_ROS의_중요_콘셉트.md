# 4장 ROS의 중요 콘셉트

## 4.1. ROS 용어 정리

#### ROS

- 로봇의 응용프로그램을 개발하기 위한 운영체제와 같은 로봇 소프트웨어 플랫폼이다.

#### 마스터 master

- 노드와 노드 사이의 연결과 메세지 통신을 위한 네임 서버와 같은 역할을 한다.
- roscore가 실행 명령어다.
- 마스터를  실행하면 각 노드의 이름을 등록하고 필요에 따라 정보를 받을 수 있다. 
- 마스터 없이는 노드 간의 접속, 토픽과 서비스 같은 메세지 통신을 할 수 없다.

#### 노드 Node

- ROS에서 실행되는 최소 단위의 프로세서를 지칭한다. 즉 하나의 실행 가능한 프로그램으로 생각하면 된다.
- ROS에서는 하나의 목적에 하나의 노드를 작성, 재사용 쉽게 구성하여 개발하기 권한다.
- 노드는 구동과 함께 마스터에 노드 이름과 publishser, subscriber, service server, service client에서 사용하는 토픽 및 서비스 이름, 메세지 형태. URI 주소와 포트를 등록한다. 이 정보들을 기반으로 각 노드는 노드끼리 토픽과 서비스를 이용하여 메세지를 주고받을 수 있다.

#### 패키지 package

- ROS를 구성하는 기본 단뒤이다.
- ROS의 응용프로그램은 패키지 단위로 개발되며 패키지는 최소한 하나 이상의 노드를 포함하거나 다른 패키지의 노드를 실행하기 위한 설정 파일들을 포함하게 된다.

#### 메타패키지 metapackage

- 공통된 목적을 지닌 패키지들의 집합
- 예) Navigation 메타패키지는 AMCL, DWA, EKF ... 등으로 구성되어 있다.

#### 메시지 message

- 노드는 message를 통해 노드 간의 데이터를 주고 받는다.
- 메시지는 interger, floating, point, boolean과 같은 변수 형태이다. 또한 메시지 안에 메시지를 품고 있는 간단한 데이터 구조나 메시지들이 나열된 배열과 같은 구조도 사용할 수 있다.
- 메시지를 이용한 통신 방법으로 단방향 메시지 송수신 방식의 topic, 양방향 메시지 request/response 방식의 service를 이용한다.

#### 토픽 topic

- 이야깃거리

-  publisher 노드가 하나의 이야깃거리에 대해서 토픽으로 마스터에 등록한 후, 이야깃서리에 대한 이야기를 메시지 형태로 퍼블리시 한다.
- 이 이야깃거리를 수신받기를 원하는 subscriber 노드는 마스터에 등록된 토픽의 이름에 해당하는 퍼블리셔 노드의 정보를 받는다.

#### 퍼블리시 및 퍼블리셔 publish/publisher

- publish는 토픽의 내용에 해당하는 메시지 형태의 데이터를 송신하는 것을 말한다.
- publisher 노드는 publish를 수행하기 위하여 토픽을 포함한 자신의 정보들을 마스터에 등록하고, subscribe를 원하는 subscribe 노드에 메시지를 보낸다.
- publisher는 이를 실행하는 개체로써 노드에서 선언한다. 그리고 하나의 노드에서 복수로 선언할 수 있다.

#### 서브스크라이브 및 서브스크라이버 subscribe/subscriber

- subscribe는 토픽의 내용에 해당하는 메시지 형태의 데이터를 수신하는 것을 말한다.
- subscriber 노드는 subscribe를 수행하기 위하여 토픽을 포함한 자신의 정보들을 마스터에 등록하고, 구독하고자 하는 토픽을 퍼블리시하는 퍼블리셔 노드의 정보를 마스터로부터 받는다.
- publish와 subscribe 개념의 토픽 방식은 비동기 방식이라 필요에 따라서 주어진 데이터를 전송하고 받기에 매우 훌륭한 방법이다.  
- 한 번의 접속으로 지속적인 메시지를 송수신하기 때문에 지속해서 메시지를 발송해야 하는 센서 데이터에 적합하여 많이 사용된다. 

#### 서비스 service

- 서비스 메시지 통신은 특정 목적의 작업에 해당되는 서비스를 요청하는 service client와 service response을 담당하는 service server간의 동기적 양방향 서비스 메시지 통신을 말한다.
- 토픽과는 달리 일회성 메시지 통신이다. 
- 서비스의 요청과 응답이 완료되면 연결된 두 노드의 접속은 끊긴다.

#### 서비스 서버 service server

- service server는 요청을 입력으로 받고, 응답을 출력으로 하는 서비스 메시지 통신의 서버 역할을 말한다.
- request와 response은 모두 메시지로 되어 있으며, 서비스 요청을 받으면 지정된 서비스를 수행한 다음 그 결과를 서비스 클라이언트에 전달한다.
- 서비스 서버는 정해진 명령을 받아 수행하는 노드에 사용된다.

#### 서비스 클라이언트 service client

- service client는 요청을 출력으로 하고, 응답을 입력으로 받는 서비스 메시지 통신의 클라이언트 역할을 말한다.
- request와 response는 모두 메시지로 되어 있으며, 서비스 요청을 서비스 서버에 전달하고 그 결괏값을 받는다. 서비스 클라이언트는 정해진 명령을 지시하고 결괏값을 받는 노드에 사용된다.

#### 액션 action

- action은 service처럼 양방향을 요구하나 요청 처리 후 응답까지 오랜 시간이 걸리고 중간 결괏값이 필요한 경우에 사용되는 메시지 통신 방식이다.
- action파일도 service와 비슷하게 요청과 응답에 해당되는 목표(goal)와 결과(result) 그리고 결과값에 해당되는 피드백(feedback)이 추가되었다.
- action client와 목표에 맞추어 정해진 일을 수행하고 액션 피드백과 결과를 전달하는 action server로 구성되어 있고 이들 간의 비동기식 양방향 메시지 통신을 수행한다.

#### 액션 서버 action server



#### 액션 클라이언트 action client



#### 파라미터 parameter







## 4.2. 메세지 통신





### 4.2.1. 토픽(topic)



### 4.2.2. 서비스(service)



### 4.2.3. 액션(action)



### 4.2.4. 파라미터(parameter)



### 4.2.5. 메세지 통신의 흐름



## 4.3. 메세지



### 4.3.1. msg 파일



### 4.3.2. srv 파일



### 4.3.3. action 파일



## 4.4. 네임(name)



## 4.5. 좌표 변환(TF)



## 4.6. 클라이언트 라이브러리



## 4.7. 이기종 디바이스 간의 통신



## 4.8. 파일 시스템



### 4.8.1. 파일 구성



### 4.8.2. 설치 폴더



### 4.8.3. 작업 폴더



## 4.9. 빌드 시스템



### 4.9.1 패키지 생성



### 4.9.2. 패키지 설정 파일(package.xml) 수정



### 4.9.3. 빌드 설정 파일(CMakeLists.txt) 수정



### 4.9.4. 소스 코드 작성



### 4.9.5. 패키지 빌드



### 4.9.6 노드 실행

